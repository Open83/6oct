<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Saraaaa ‚Äî Gift (Improved)</title>
<style>
  :root{
    --bg1:#667eea; --bg2:#764ba2; --bg3:#f093fb;
    --accent1:#ec4899; --accent2:#f59e0b;
    --glass: rgba(255,255,255,0.10);
    --glass-strong: rgba(255,255,255,0.95);
    --dark: #222;
    --env-w: min(86vw, 440px);
    --env-h: calc(var(--env-w) * 0.62);
    --anim-fast: 360ms;
    --anim-med: 620ms;
    --anim-slow: 900ms;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family: Inter, "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
    background: linear-gradient(135deg,var(--bg1) 0%,var(--bg2) 50%,var(--bg3) 100%);
    -webkit-font-smoothing:antialiased;
    color:#fff; padding:18px; display:flex; justify-content:center;
  }

  .app { width:100%; max-width:1080px; }

  /* Screen wrapper */
  .screen{ display:none; }
  .screen.active{ display:block; animation: fadeIn var(--anim-med) ease both; }
  @keyframes fadeIn { from { opacity:0; transform: translateY(8px); } to { opacity:1; transform:none; } }

  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    border-radius:18px; padding:18px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.25);
    border:1px solid rgba(255,255,255,0.08);
  }

  header.top { display:flex; align-items:center; gap:12px; margin-bottom:12px; }
  h1.title { font-size:20px; margin-bottom:0; font-weight:800; letter-spacing:0.2px; }
  p.subtitle { margin:0; opacity:0.95; font-weight:600; color: #fffbff }

  .btn {
    padding:10px 14px; border-radius:12px; background:linear-gradient(90deg,var(--accent1),var(--accent2));
    color:white; border:none; font-weight:800; cursor:pointer; box-shadow:0 8px 26px rgba(236,72,153,0.24);
  }
  .ghost {
    background: rgba(255,255,255,0.08); color:#fff; border:1px solid rgba(255,255,255,0.08);
  }

  /* MENU GRID */
  .grid { display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-top:12px; }
  @media (max-width:560px){ .grid { grid-template-columns:repeat(1,1fr); } }
  .card {
    padding:14px; border-radius:12px; cursor:pointer; text-align:center;
    background: rgba(255,255,255,0.04); transition: transform 260ms ease, box-shadow 260ms ease;
    border:1px solid rgba(255,255,255,0.06);
  }
  .card:hover{ transform: translateY(-6px); box-shadow:0 18px 40px rgba(0,0,0,0.25); }

  .card .icon{ font-size:32px; margin-bottom:8px; display:block }

  /* Envelope Scene */
  .env-wrap{ display:flex; gap:14px; align-items:center; flex-direction:column; padding-top:8px }
  .env-scene{ width:var(--env-w); height:var(--env-h); perspective:1400px; -webkit-perspective:1400px; }
  .envelope {
    width:100%; height:100%; position:relative; transform-style:preserve-3d; user-select:none;
    transition: transform var(--anim-slow) cubic-bezier(.18,.9,.24,1);
    pointer-events:auto;
  }

  /* envelope body */
  .env-body {
    position:absolute; inset:0; border-radius:10px; background: linear-gradient(180deg,#fff,#fff9fb);
    box-shadow: 0 16px 40px rgba(0,0,0,0.22), inset 0 2px 0 rgba(0,0,0,0.03);
    border:1px solid rgba(0,0,0,0.04);
    transform: translateZ(-6px); overflow:hidden;
  }

  /* flap - big top triangle look */
  .env-flap {
    position:absolute; left:0; right:0; top:0; height:62%;
    transform-origin: 50% 0%;
    background: linear-gradient(180deg,#ffdff6 0%,#ffd3ee 100%);
    border-top-left-radius:10px; border-top-right-radius:10px;
    box-shadow: 0 14px 40px rgba(0,0,0,0.24);
    transform: rotateX(0deg) translateZ(40px);
    transition: transform var(--anim-slow) cubic-bezier(.18,.9,.24,1);
  }

  /* decorative crease */
  .env-flap::after {
    content:""; position:absolute; left:0; right:0; bottom:0; height:28px;
    background: linear-gradient(180deg, rgba(255,255,255,0.25), rgba(0,0,0,0.02));
    pointer-events:none;
  }

  /* flap open state */
  .envelope.is-open .env-flap { transform: rotateX(-165deg) translateZ(40px); }

  /* envelope inner (paper) visible area */
  .env-inner {
    position:absolute; left:8px; right:8px; top:calc(62%); bottom:12px;
    background: linear-gradient(180deg,#fff,#fff7fb); border-radius:6px; padding:12px;
    transform: translateZ(-12px);
  }

  /* Letter sheet (hidden initially) */
  .letter {
    position:absolute; left:12px; right:12px; top:18%; height:60%;
    background: linear-gradient(180deg,#fff,#fffefc);
    border-radius:6px; padding:14px; box-shadow:0 18px 40px rgba(0,0,0,0.18);
    transform-origin: 50% 100%;
    transform: translateY(18px) scale(.96) rotateX(6deg);
    opacity:0; transition: transform var(--anim-med) cubic-bezier(.18,.9,.24,1), opacity var(--anim-med);
    overflow:auto; color:var(--dark);
  }
  .envelope.is-open .letter { opacity:1; transform: translateY(0) scale(1) rotateX(0deg); }

  /* seal for closed look */
  .seal {
    position:absolute; inset:auto 16px 18px auto; width:54px; height:54px; border-radius:50%;
    background: linear-gradient(90deg,var(--accent1),var(--accent2)); display:flex; align-items:center; justify-content:center;
    color:white; font-weight:900; box-shadow:0 8px 22px rgba(236,72,153,0.3);
    z-index:6;
  }

  /* hint */
  .hint { color: rgba(255,255,255,0.95); font-weight:800; margin-top:8px; font-size:14px; text-align:center; }

  /* back button small */
  .back-row { display:flex; align-items:center; gap:10px; margin-bottom:8px }
  .icon-btn { width:44px; height:44px; border-radius:10px; display:inline-grid; place-items:center; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.06); cursor:pointer }

  /* Moments: polished flip card */
  .moments-grid { display:grid; gap:12px; grid-template-columns: repeat(2, 1fr); margin-top:12px; }
  @media (max-width:560px){ .moments-grid { grid-template-columns:1fr; } }
  .flip-card { perspective:1000px; height:160px; }
  .flip-inner { position:relative; width:100%; height:100%; transition: transform var(--anim-fast) cubic-bezier(.2,.9,.3,1); transform-style:preserve-3d; cursor:pointer; border-radius:12px; box-shadow: 0 12px 34px rgba(0,0,0,0.22); }
  .flip-front, .flip-back {
    position:absolute; inset:0; backface-visibility:hidden; border-radius:12px; display:flex; align-items:center; justify-content:center; padding:14px; text-align:center;
  }
  .flip-front { background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03)); color:#fff; font-weight:800; }
  .flip-back { background: #fff; color:var(--dark); transform: rotateY(180deg); font-weight:700; }
  .flip-inner.is-flipped { transform: rotateY(180deg); }

  /* Playlist - kept minimal */
  .song { display:flex; gap:12px; align-items:center; padding:10px; border-radius:10px; background:rgba(255,255,255,0.03); margin-top:10px; }
  .song .cover { width:56px; height:56px; border-radius:10px; background: linear-gradient(90deg,var(--accent1),var(--accent2)); display:grid; place-items:center; font-size:22px; }

  /* Wheel */
  .wheel-wrap{ display:flex; flex-direction:column; align-items:center; gap:12px; margin-top:12px; }
  .wheel-canvas { width:min(88vw,420px); max-width:420px; height:auto; border-radius:50%; background:transparent; touch-action:manipulation; }
  .pointer { width:0; height:0; border-left:18px solid transparent; border-right:18px solid transparent; border-bottom:28px solid #fff; filter:drop-shadow(0 6px 12px rgba(0,0,0,0.25)); margin-bottom:-12px; transform-origin:center top; transition: transform 220ms ease; }

  .spin-row { display:flex; gap:12px; align-items:center; margin-top:6px; }
  .result-modal{
    position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); min-width:260px; max-width:92vw; z-index:9999;
    padding:16px; border-radius:12px; background: white; color:var(--dark); box-shadow:0 35px 90px rgba(0,0,0,0.45); display:none; text-align:center;
  }
  .result-modal.show{ display:block; animation: pop 260ms cubic-bezier(.2,.9,.3,1) both; }
  @keyframes pop{ from{ transform:translate(-50%,-50%) scale(.92); opacity:0 } to{ transform:translate(-50%,-50%) scale(1); opacity:1 } }

  /* small utilities */
  .muted{ opacity:.92; font-size:13px; color:#fff; margin-top:8px; text-align:center }
  .sr-only{ position:absolute; left:-9999px; top:auto; height:1px; width:1px; overflow:hidden }
  @media (max-width:420px){
    :root{ --env-w: 92vw; }
    .env-scene{ height: calc(var(--env-w) * 0.62); }
  }

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce){
    .env-flap, .letter, .flip-inner { transition: none !important; animation: none !important; }
  }
</style>
</head>
<body>
  <div class="app">
    <!-- WELCOME -->
    <div id="welcome" class="screen active">
      <div class="panel" style="display:flex;flex-direction:column;gap:12px;align-items:center">
        <div style="font-size:64px">üíù</div>
        <h1 class="title">Hello Saraaaa ‚ô•Ô∏è</h1>
        <p class="subtitle">A small surprise from Sayed ‚Äî tap "Open Gift" below</p>
        <div style="display:flex;gap:10px;margin-top:6px">
          <button class="btn" onclick="show('menu')">Open Gift üéÅ</button>
          <button class="btn ghost" onclick="show('game')">Skip to Wheel üé°</button>
        </div>
      </div>
    </div>

    <!-- MENU -->
    <div id="menu" class="screen">
      <div class="panel">
        <div class="top">
          <div class="top-row">
            <div>
              <h1 class="title">Meri Jaan ‚ù§Ô∏è</h1>
              <p class="subtitle">Pick something fun ‚Äî I customised everything for you</p>
            </div>
            <div style="flex:1"></div>
            <div><button class="icon-btn" onclick="show('welcome')" title="Back">‚üµ</button></div>
          </div>
        </div>

        <div class="grid" style="margin-top:12px">
          <div class="card" onclick="show('letter')"><span class="icon">üíå</span><div style="font-weight:900">Love Letter</div><div style="opacity:.95;margin-top:6px">Tap to open the envelope</div></div>
          <div class="card" onclick="show('moments')"><span class="icon">‚ú®</span><div style="font-weight:900">Moments</div><div style="opacity:.95;margin-top:6px">Flip and read</div></div>
          <div class="card" onclick="show('playlist')"><span class="icon">üéµ</span><div style="font-weight:900">Playlist</div><div style="opacity:.95;margin-top:6px">Songs for you</div></div>
          <div class="card" onclick="show('game')"><span class="icon">üé°</span><div style="font-weight:900">Spin the Wheel</div><div style="opacity:.95;margin-top:6px">Romantic + playful</div></div>
        </div>
      </div>
    </div>

    <!-- LETTER (ENVELOPE) -->
    <div id="letter" class="screen">
      <div class="panel">
        <div class="back-row"><button class="icon-btn" id="backFromLetter" title="Close">‚úï</button><div style="margin-left:8px"><h1 class="title">Love Letter</h1><div class="muted">Tap the envelope to open</div></div></div>

        <div class="env-wrap">
          <div class="env-scene" id="envScene" aria-hidden="false">
            <div class="envelope" id="envelope" role="button" aria-pressed="false" tabindex="0">
              <div class="env-flap" id="envFlap" aria-hidden="true"></div>
              <div class="env-body" aria-hidden="true">
                <div class="env-inner"></div>
              </div>

              <div class="letter" id="letterSheet" aria-hidden="true">
                <div style="font-weight:900;font-size:18px;margin-bottom:8px;color:var(--dark)">Meri Bacchiii ‚ô•Ô∏è</div>
                <div style="color:var(--dark);line-height:1.55;font-size:14px;white-space:pre-wrap">
Saraaaa‚ô•Ô∏è
Kal raat jo hua uske baare mein main soch raha tha aur mujhe yeh feel hua ki main bhi galat tha tumne aaj call karke sorry bola lekin mujhe bhi sorry kehna hai shayad main thoda zyada rude ho gaya tha jab mujhe bas shant rehna chahiye tha mujhe tumse ladna bilkul pasand nahi hai kyunki har baar jab hum door hote hain lagta hai jaise kuch andar se adhura ho gaya ho

Tum waise hi rare ho jaise duniya mein bas ek hi misal ho ‚Äî tumhari aankhon ka sukoon, tumhare words ka warmth, sab kuch mujhe feel karata hai ki main kitna lucky hoon. I Lykeeeeeee Uuuuuuuuuuuuuuuuhhhhh Meri Jaaaaaaaaannnnnn ‚ù§Ô∏èüíã
                </div>
                <div style="text-align:right;margin-top:10px;font-weight:800;color:#444">‚Äî Sayed Asif</div>
              </div>

              <div class="seal" id="seal">‚ù§</div>
            </div>
          </div>
          <div class="hint">Tap envelope to open ‚Ä¢ Tap again to close</div>
        </div>
      </div>
    </div>

    <!-- MOMENTS (polished flips) -->
    <div id="moments" class="screen">
      <div class="panel">
        <div style="display:flex;align-items:center;gap:12px"><button class="icon-btn" onclick="show('menu')">‚úï</button><div><h1 class="title">Special Moments</h1><div class="muted">Tap a card to flip</div></div></div>

        <div class="moments-grid" style="margin-top:12px">
          <div class="flip-card">
            <div class="flip-inner" data-idx="0">
              <div class="flip-front">üò∏ <div style="font-weight:800;margin-top:8px">Tumhra naam hi sukoon hai</div></div>
              <div class="flip-back">Jab bhi tumhara naam leta hoon na Saraaaa‚ù§Ô∏è dil ek ajeeb si raahat mehsoos karta hai...</div>
            </div>
          </div>

          <div class="flip-card">
            <div class="flip-inner" data-idx="1">
              <div class="flip-front">üòª <div style="font-weight:800;margin-top:8px">Tumhre bina adhoora</div></div>
              <div class="flip-back">Tumhara na hona jaise saansein ruk jaayein ‚Äî sab adhoora lagta hai.</div>
            </div>
          </div>

          <div class="flip-card">
            <div class="flip-inner" data-idx="2">
              <div class="flip-front">üòΩ <div style="font-weight:800;margin-top:8px">Touch mein jaadu</div></div>
              <div class="flip-back">Jab tumhara haath mere haath mein aata hai to lagta hai duniya thum si gayi hai...</div>
            </div>
          </div>

          <div class="flip-card">
            <div class="flip-inner" data-idx="3">
              <div class="flip-front">üê± <div style="font-weight:800;margin-top:8px">Tu meri aadat</div></div>
              <div class="flip-back">Har din tum meri aadat banti ja rahi ho ‚Äî chhodna mumkin nahi.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PLAYLIST (kept) -->
    <div id="playlist" class="screen">
      <div class="panel">
        <div style="display:flex;align-items:center;gap:12px"><button class="icon-btn" onclick="show('menu')">‚úï</button><div><h1 class="title">Playlist For You</h1><div class="muted">Songs dedicated to you</div></div></div>

        <div style="margin-top:12px">
          <div class="song">
            <div class="cover">üéß</div>
            <div>
              <div style="font-weight:900">Shiddat</div>
              <div style="opacity:.95;margin-top:6px">Saraaaa ‚ô•Ô∏è</div>
            </div>
          </div>

          <div class="song">
            <div class="cover">üéß</div>
            <div>
              <div style="font-weight:900">Jeene Laga Hoon</div>
              <div style="opacity:.95;margin-top:6px">Saraaaa ‚ô•Ô∏è</div>
            </div>
          </div>

          <div style="margin-top:12px">
            <iframe width="100%" height="88" style="border-radius:8px;border:none" src="https://www.youtube.com/embed/iSo9l950QLo?si=zrDGjksZnXu4rE83" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          </div>
        </div>
      </div>
    </div>

    <!-- GAME: SPIN WHEEL (improved) -->
    <div id="game" class="screen">
      <div class="panel">
        <div style="display:flex;align-items:center;gap:12px"><button class="icon-btn" onclick="show('menu')">‚úï</button><div><h1 class="title">Spin the Wheel</h1><div class="muted">Romantic + playful</div></div></div>

        <div class="wheel-wrap">
          <div class="pointer" aria-hidden="true"></div>
          <canvas id="wheelCanvas" class="wheel-canvas" width="680" height="680" aria-label="Spin the wheel"></canvas>
          <div class="spin-row">
            <button class="btn" id="spinBtn">SPIN</button>
            <button class="btn ghost" id="quickSpin">QUICK</button>
          </div>
          <div class="muted">Tip: press SPIN and wait ‚Äî the wheel will slow elegantly.</div>
        </div>
      </div>
    </div>

    <!-- RESULT -->
    <div id="result" class="result-modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div style="font-size:32px">üéâ</div>
      <div id="resTitle" style="font-weight:900;font-size:18px;margin-top:6px"></div>
      <div id="resType" style="margin-top:8px;font-weight:700;color:#444"></div>
      <div style="margin-top:12px"><button class="btn" id="resOk">OK</button></div>
    </div>
  </div>

<script>
/* ----------------- Simple navigation ----------------- */
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  const el = document.getElementById(id);
  if(el) el.classList.add('active');

  // Reset envelope if navigating to it (closed)
  if(id === 'letter') resetEnvelopeInstant();
}

/* ----------------- Envelope logic (robust) ----------------- */
const envelope = document.getElementById('envelope');
const envFlap = document.getElementById('envFlap');
const letterSheet = document.getElementById('letterSheet');
const backFromLetter = document.getElementById('backFromLetter');

let isOpen = false;
let envLock = false;

const OPEN_DELAY = 260;
const CLOSE_DELAY = 340;

function openEnvelope(){
  if(envLock || isOpen) return;
  envLock = true;
  envelope.classList.add('is-open');
  envelope.setAttribute('aria-pressed','true');
  // show letter after flap swings a bit
  setTimeout(()=> {
    letterSheet.setAttribute('aria-hidden','false');
    letterSheet.classList.add('visible'); // purely semantic - CSS handles via parent class
    isOpen = true;
    envLock = false;
  }, OPEN_DELAY);
}

function closeEnvelope(callback){
  if(envLock || !isOpen){ // if already closed, run callback immediately
    envelope.classList.remove('is-open');
    envelope.setAttribute('aria-pressed','false');
    letterSheet.setAttribute('aria-hidden','true');
    isOpen = false;
    if(typeof callback === 'function') setTimeout(callback, 40);
    return;
  }
  envLock = true;
  // hide letter first
  letterSheet.setAttribute('aria-hidden','true');
  setTimeout(()=> {
    envelope.classList.remove('is-open');
    envelope.setAttribute('aria-pressed','false');
    setTimeout(()=> {
      isOpen = false;
      envLock = false;
      if(typeof callback === 'function') callback();
    }, CLOSE_DELAY);
  }, 160);
}

function resetEnvelopeInstant(){
  envLock = false; isOpen = false;
  envelope.classList.remove('is-open');
  envelope.setAttribute('aria-pressed','false');
  letterSheet.setAttribute('aria-hidden','true');
}

// click/tap envelope
envelope.addEventListener('click', ()=>{
  if(envLock) return;
  if(!isOpen) openEnvelope();
  else closeEnvelope();
});
// keyboard accessibility: Enter/Space toggles
envelope.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); envelope.click(); }
});

// back button: if open, close envelope then go to menu; if closed, directly go to menu
backFromLetter.addEventListener('click', ()=>{
  if(isOpen){
    closeEnvelope(()=> show('menu'));
  } else {
    show('menu');
  }
});

/* ----------------- Flip card interactions ----------------- */
document.querySelectorAll('.flip-inner').forEach(inner=>{
  inner.addEventListener('click', ()=>{
    // toggle flipped
    inner.classList.toggle('is-flipped');
  });
});

/* ----------------- Wheel: responsive canvas + smooth spin ----------------- */
const canvas = document.getElementById('wheelCanvas');
const ctx = canvas.getContext('2d', { alpha: true });
let cw, ch, DPR;
function resizeCanvas(){
  DPR = window.devicePixelRatio || 1;
  const cssSize = Math.min(window.innerWidth * 0.88, 420);
  canvas.style.width = cssSize + 'px';
  canvas.style.height = cssSize + 'px';
  canvas.width = Math.round(cssSize * DPR);
  canvas.height = Math.round(cssSize * DPR);
  cw = canvas.width; ch = canvas.height;
  ctx.setTransform(DPR,0,0,DPR,0,0);
  drawWheel(currentAngle || 0);
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

/* Items (mix of romantic + playful) */
const items = [
  {text: "A soft kiss", type:"Romantic"},
  {text: "Sing 1 line", type:"Cute"},
  {text: "Compliment eyes", type:"Romantic"},
  {text: "Slow dance 30s", type:"Cute"},
  {text: "A long hug", type:"Romantic"},
  {text: "Share cutest memory", type:"Cute"},
  {text: "Cook her favorite", type:"Romantic"},
  {text: "Whisper a secret", type:"Cute"},
  {text: "Write a love note", type:"Romantic"},
  {text: "Send a silly selfie", type:"Cute"},
  {text: "Promise one date", type:"Romantic"},
  {text: "Do 10 squats together", type:"Cute"}
];
const n = items.length;
const colors = ['#ffe6f6','#ffdff0','#fff1f6','#fff7ee','#ffedfa','#fff5f0'];

/* draw wheel segments & text */
function drawWheel(angle){
  // angle = radians rotation applied to the whole wheel (0 at initial)
  const size = Math.min(window.innerWidth * 0.88, 420);
  const cx = size/2, cy = size/2, radius = size/2 - 10;
  ctx.clearRect(0,0,size,size);

  ctx.save();
  ctx.translate(cx,cy);
  ctx.rotate(angle);
  const slice = (2*Math.PI)/n;

  for(let i=0;i<n;i++){
    const start = i * slice;
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,radius, start, start + slice);
    ctx.closePath();
    ctx.fillStyle = colors[i % colors.length];
    ctx.fill();
    ctx.strokeStyle = "rgba(0,0,0,0.06)";
    ctx.lineWidth = 1;
    ctx.stroke();

    // text rotated
    ctx.save();
    ctx.rotate(start + slice/2);
    ctx.textAlign = "right";
    ctx.fillStyle = "#222";
    ctx.font = "bold 14px Inter, system-ui, Arial";
    const text = items[i].text;
    wrapText(ctx, text, radius - 18, -10, 14);
    ctx.restore();
  }

  // center circle
  ctx.beginPath();
  ctx.arc(0,0,36,0,2*Math.PI);
  ctx.fillStyle = "#fff";
  ctx.fill();
  ctx.fillStyle = "#222"; ctx.font = "700 20px Inter, Arial"; ctx.textAlign="center";
  ctx.fillText("‚ù§",0,6);
  ctx.restore();

  // small ticks on outer rim
  ctx.beginPath();
  ctx.translate(cx,cy);
  for(let i=0;i<n*2;i++){
    const a = i * (Math.PI*2) / (n*2);
    const x1 = Math.cos(a) * (radius + 4), y1 = Math.sin(a) * (radius + 4);
    const x2 = Math.cos(a) * (radius + 12), y2 = Math.sin(a) * (radius + 12);
    ctx.moveTo(x1,y1); ctx.lineTo(x2,y2);
  }
  ctx.strokeStyle = "rgba(0,0,0,0.06)"; ctx.lineWidth=1; ctx.stroke();
}

/* helper to wrap text along radius (keeps simple multi-line right-aligned) */
function wrapText(ctx, text, maxWidth, y, lineHeight){
  const words = text.split(' ');
  let line = '', lines = [], test;
  words.forEach(w=>{
    test = line ? (line + ' ' + w) : w;
    if(ctx.measureText(test).width > maxWidth && line){
      lines.push(line); line = w;
    } else line = test;
  });
  if(line) lines.push(line);
  // print lines from top to bottom (centered)
  const totalH = lines.length * lineHeight;
  let startY = - (totalH/2) + y;
  lines.forEach((ln,i)=>{
    ctx.fillText(ln, maxWidth, startY + i*lineHeight);
  });
}

/* spin animation */
let currentAngle = 0; // radians
let animating = false;
const spinBtn = document.getElementById('spinBtn');
const quickSpinBtn = document.getElementById('quickSpin');

function easeOutCubic(t){ return 1 - Math.pow(1-t,3); }

function spin(randomTargetIndex=null, quick=false){
  if(animating) return;
  animating = true;
  const start = currentAngle;
  const full = (Math.PI*2)*(3 + Math.floor(Math.random()*3)) + (quick?0: (Math.PI*2)* (Math.random()*1.3));
  // choose target index
  const targetIndex = (randomTargetIndex !== null) ? randomTargetIndex : Math.floor(Math.random() * n);
  const slice = (2*Math.PI)/n;
  // we want the slice center to land at pointer top (i.e. angle where slice center + rotation = -PI/2)
  const sliceCenter = targetIndex * slice + slice/2;
  const desiredEndRotation = -Math.PI/2 - sliceCenter;
  const end = start + full + (desiredEndRotation - start % (2*Math.PI));
  const duration = quick ? 900 : (1800 + Math.random()*1300); // ms

  const t0 = performance.now();
  (function animate(now){
    const elapsed = now - t0;
    const t = Math.min(1, elapsed / duration);
    const eased = easeOutCubic(t);
    currentAngle = start + (end - start) * eased;
    drawWheel(currentAngle);
    // pointer small wobble while spinning
    const pointer = document.querySelector('.pointer');
    if(pointer) pointer.style.transform = `rotate(${Math.sin(elapsed/120)*6}deg)`;
    if(t < 1) requestAnimationFrame(animate);
    else {
      // finish
      animating = false;
      pointer.style.transform = `rotate(0deg)`;
      // compute landed index
      const normalized = (currentAngle % (2*Math.PI) + 2*Math.PI) % (2*Math.PI);
      const pointerAngle = (3*Math.PI/2 - normalized + 2*Math.PI) % (2*Math.PI);
      const idx = Math.floor(pointerAngle / slice) % n;
      showResult(idx);
    }
  })(performance.now());
}

/* spin buttons */
spinBtn.addEventListener('click', ()=> spin(null,false));
quickSpinBtn.addEventListener('click', ()=> spin(null,true));

/* show result UI */
const resultModal = document.getElementById('result');
const resTitle = document.getElementById('resTitle');
const resType = document.getElementById('resType');
const resOk = document.getElementById('resOk');

function showResult(idx){
  const it = items[idx];
  resTitle.textContent = it.text;
  resType.textContent = it.type === 'Romantic' ? 'A romantic surprise ‚ù§Ô∏è' : 'A playful dare üòÑ';
  resultModal.classList.add('show');
  resultModal.setAttribute('aria-hidden','false');
}
resOk.addEventListener('click', ()=> {
  resultModal.classList.remove('show');
  resultModal.setAttribute('aria-hidden','true');
});

/* initial draw */
drawWheel(currentAngle);

/* Accessibility: close result with ESC */
window.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){
    if(resultModal.classList.contains('show')){ resultModal.classList.remove('show'); resultModal.setAttribute('aria-hidden','true'); }
    // if envelope open, close on ESC
    if(isOpen) closeEnvelope();
  }
});

/* Small polish: prevent accidental double touches on mobile */
let lastTap = 0;
document.body.addEventListener('touchend', (e)=>{
  const now = Date.now();
  if(now - lastTap < 260) e.preventDefault();
  lastTap = now;
}, {passive:true});
</script>
</body>
</html>
